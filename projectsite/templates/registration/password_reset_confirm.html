{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Real's Food Products{% endblock %}</title>

  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <link rel="stylesheet" href="{% static 'css/login.css' %}">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <div class="login-container">
    <!-- Left Section -->
    <div class="login-left">
      <div class="brand">
        <img src="{% static 'img/reals.jpg' %}" alt="Logo" class="brand-logo">
        <h2>HELLO! This is the reset confirm page</h2>
      </div>
      <div class="footer-left">
        <p>&copy; Reals Food Products</p>
      </div>
    </div>

    <!-- Right Section -->
    <div class="login-right">
      <div class="form-wrapper">
        <p>Please enter your new password.</p>
        {% block content %}
        <form method="post">
          {% csrf_token %}

          {% for field in form %}
            <div class="mb-3">
              <label class="form-label">{{ field.label }}</label>
              {{ field }}

              {% if field.errors %}
                <div class="text-danger small">
                  {% for error in field.errors %}
                    <p class="mb-0">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          {% endfor %}

          <!-- Password strength indicator -->
          <div id="password-requirements" class="password-feedback mb-3">
            <p>Password must contain:</p>
            <ul>
              <li id="length" class="invalid">❌ At least 8 characters</li>
              <li id="number" class="invalid">❌ At least one number</li>
              <li id="uppercase" class="invalid">❌ At least one uppercase letter</li>
              <li id="lowercase" class="invalid">❌ At least one lowercase letter</li>
            </ul>
          </div>

                <!-- Non-field errors (will be shown above the submit button) -->
                {% if form.non_field_errors %}
                    <div class="alert alert-danger mt-2">
                        {% for error in form.non_field_errors %}
                            <p class="mb-0">{{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}
      </div>
    </div>
  </div>

  <!-- JS for live validation -->
  <script>
  const form = document.querySelector('form');  // Get the form
form.addEventListener('submit', function (e) {
    if (!isValidPassword(passwordInput.value)) {
        e.preventDefault();  // Prevent form submission
        alert("Password does not meet the requirements.");
    }
});

function isValidPassword(password) {
    const lengthValid = password.length >= 8;
    const numberValid = /\d/.test(password);
    const uppercaseValid = /[A-Z]/.test(password);
    const lowercaseValid = /[a-z]/.test(password);

    return lengthValid && numberValid && uppercaseValid && lowercaseValid;
}

    const passwordInput = document.getElementById("id_new_password1"); 
    const lengthReq = document.getElementById("length");
    const numberReq = document.getElementById("number");
    const uppercaseReq = document.getElementById("uppercase");
    const lowercaseReq = document.getElementById("lowercase");

    if (passwordInput) {
      passwordInput.addEventListener("input", () => {
        const value = passwordInput.value;

        // length check
        if (value.length >= 8) {
          lengthReq.classList.add("valid");
          lengthReq.classList.remove("invalid");
          lengthReq.textContent = "✅ At least 8 characters";
        } else {
          lengthReq.classList.add("invalid");
          lengthReq.classList.remove("valid");
          lengthReq.textContent = "❌ At least 8 characters";
        }

        // number check
        if (/\d/.test(value)) {
          numberReq.classList.add("valid");
          numberReq.classList.remove("invalid");
          numberReq.textContent = "✅ At least one number";
        } else {
          numberReq.classList.add("invalid");
          numberReq.classList.remove("valid");
          numberReq.textContent = "❌ At least one number";
        }

        // uppercase check
        if (/[A-Z]/.test(value)) {
          uppercaseReq.classList.add("valid");
          uppercaseReq.classList.remove("invalid");
          uppercaseReq.textContent = "✅ At least one uppercase letter";
        } else {
          uppercaseReq.classList.add("invalid");
          uppercaseReq.classList.remove("valid");
          uppercaseReq.textContent = "❌ At least one uppercase letter";
        }

        // lowercase check
        if (/[a-z]/.test(value)) {
          lowercaseReq.classList.add("valid");
          lowercaseReq.classList.remove("invalid");
          lowercaseReq.textContent = "✅ At least one lowercase letter";
        } else {
          lowercaseReq.classList.add("invalid");
          lowercaseReq.classList.remove("valid");
          lowercaseReq.textContent = "❌ At least one lowercase letter";
        }

      });
    }
  </script>
</body>
</html>
