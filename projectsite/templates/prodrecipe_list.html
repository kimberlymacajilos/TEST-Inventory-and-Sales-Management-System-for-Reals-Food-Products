{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="content">
  <div class="container-fluid">
    <h4 class="page-title">
      Recipes for {{ product.product_type.name }} - {{ product.variant.name }} ({{ product.size.size_label }} {{ product.size_unit.unit_name }})
    </h4>

    <div class="row">
      <div class="col-md-12">
        <div class="card">

          <div class="card-header d-flex justify-content-between align-items-center">
            <div>
              <div class="card-title">Manage Recipes</div>
              <div class="card-category">Linked to this product</div>
            </div>
            <a href="{% url 'recipe-add' product.id %}" class="btn btn-primary">
              + Add Recipe
            </a>
          </div>

          <div class="card-body">
            <table class="table table-hover table-bordered">
              <thead class="thead-light">
                <tr>
                  <th>Material</th>
                  <th>Quantity Needed</th>
                  <th>Yield Factor</th>
                  <th style="width: 150px;">Action</th>
                </tr>
              </thead>
              <tbody>
                {% for recipe in recipes %}
                <tr>
                  <td>{{ recipe.material }}</td>
                  <td>{{ recipe.quantity_needed }}</td>
                  <td>{{ recipe.yield_factor }}</td>
                  <td>
                    <a href="{% url 'recipe-edit' recipe.id %}" class="btn btn-sm btn-warning">Edit</a>

                    <button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteRecipeModal{{ recipe.id }}">
                        Delete
                    </button>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center">No recipes yet.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>

            <div class="mt-3 text-right">
                <a href="{% url 'products' %}" class="btn btn-secondary btn-rounded">Back to Products</a>
            </div> 
          </div>
        </div>
      </div> 
    </div>
  </div>
</div>

<!-- Delete Modals (outside table) -->
{% for recipe in recipes %}
<div class="modal fade" id="deleteRecipeModal{{ recipe.id }}" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
        <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">Delete Recipe</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body">
        <p>Are you sure you want to delete this recipe?</p>
        <ul class="mb-0">
            <li><strong>Material:</strong> {{ recipe.material }}</li>
            <li><strong>Quantity:</strong> {{ recipe.quantity_needed }}</li>
        </ul>
        </div>
        <div class="modal-footer">
        <form method="post" action="{% url 'recipe-delete' recipe.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger">Yes, Delete</button>
        </form>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </div>
    </div>
    </div>
</div>
{% endfor %}


{% endblock %}
