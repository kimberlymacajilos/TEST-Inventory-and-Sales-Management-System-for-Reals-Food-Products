{% load static %}
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>{% block title %}Real's Food Product{% endblock %}</title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />

  <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">
  <!-- <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"> -->
  <link rel="stylesheet" href="{% static 'css/ready.css' %}">
  <link rel="stylesheet" href="{% static 'css/demo.css' %}">  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.css">
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> -->
  <link rel="stylesheet" href="{% static 'css/base.css' %}">

  <style>
    html body a,
    html body a:hover,
    html body a:focus,
    html body a:active,
    html body a:visited {
    text-decoration: none !important;
    }
  </style>

    
    {% block page_css %}{% endblock page_css %}

  {% block vendor_css %}{% endblock vendor_css %}
</head>
<body>
<div class="wrapper">
    <!-- Main Header -->
    <div class="main-header">
        <div class="logo-header">
            <a href="{% url 'home' %}" class="logo">Real's Food Products</a>
            <button class="navbar-toggler sidenav-toggler ml-auto" type="button" data-toggle="collapse" data-target="collapse" aria-controls="sidebar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <button class="topbar-toggler more"><i class="la la-ellipsis-v"></i></button>
        </div>
        <nav class="navbar navbar-header navbar-expand-lg">
            <div class="container-fluid">
                <ul class="navbar-nav topbar-nav ml-md-auto align-items-center">
                    <li class="nav-item">
                    <button id="themeToggle" class="theme-toggle" role="switch" aria-checked="false" aria-label="Toggle color mode">
                        <span class="track"></span>
                        <span class="knob">
                        <!-- Sun / Moon icons (inline SVG para no external deps) -->
                        <span class="icon sun" aria-hidden="true">
                            <svg viewBox="0 0 24 24"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zm10.48 14.32l1.8 1.79 1.41-1.41-1.79-1.8-1.42 1.42zM12 5V2h-0v3h0zm0 17v-3h0v3h0zM4.84 17.24l-1.8 1.79 1.41 1.41 1.79-1.8-1.4-1.4zM19.16 6.76l1.8-1.79-1.41-1.41-1.79 1.8 1.4 1.4zM22 12h-3v0h3v0zM5 12H2v0h3v0zm7 5a5 5 0 110-10 5 5 0 010 10z"/></svg>
                        </span>
                        <span class="icon moon" aria-hidden="true">
                            <svg viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                        </span>
                        </span>
                    </button>
                    </li>

                    <!-- Notifications Dropdown -->
                    <li class="nav-item dropdown hidden-caret">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" 
                           data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="la la-bell"></i>
                            {% if unread_count > 0 %}
                                <span class="notification">{{ unread_count }}</span>
                            {% endif %}
                        </a>

                        <ul class="dropdown-menu notif-box" aria-labelledby="navbarDropdown">
                            <li>
                                <div class="dropdown-title">
                                    You have {{ unread_count }} new notification{{ unread_count|pluralize }}
                                </div>
                            </li>
                            <li>
                                <div class="notif-center">
                                    {% for notif in notifications|slice:":5" %}
                                        <a href="#" class="{% if not notif.is_read %}unread{% else %}read{% endif %}">
                                            <div class="notif-icon {{ notif.css_class }}">
                                                <i class="{{ notif.icon_class }}"></i>
                                            </div>
                                            <div class="notif-content">
                                                <span class="block">{{ notif.formatted_message }}</span>
                                                <span class="time">{{ notif.notification_timestamp|date:"M d, Y, h:i a" }}</span>
                                            </div>
                                        </a>
                                    {% empty %}
                                        <div class="text-center p-2">No new notifications</div>
                                    {% endfor %}
                                </div>
                            </li>
                            <li class="dropdown-footer text-center">
                                <a href="{% url 'notifications' %}">View All Notifications</a>
                            </li>
                        </ul>
                    </li>

                    <!-- User Profile Dropdown -->
                    <li class="nav-item dropdown">
                        <a class="dropdown-toggle profile-pic" data-toggle="dropdown" href="#" aria-expanded="false">
                            <img src="{% static 'img/reals.jpg' %}" alt="user-img" width="36" class="img-circle">
                            <span>{{ request.user.username }}</span>
                        </a>
                        <ul class="dropdown-menu dropdown-user">
                            <li>
                                <div class="user-box">
                                    <div class="u-img"><img src="{% static 'img/reals.jpg' %}" alt="user"></div>
                                    <div class="u-text">
                                        <h4>{{ request.user.username }}</h4>
                                        <p class="text-muted">{{ request.user.email }}</p>
                                        <a href="{% url 'profile' %}" class="btn btn-rounded btn-danger btn-sm">View Profile</a>
                                    </div>
                                </div>
                            </li>
                            <div class="dropdown-divider"></div>
                            <form method="post" action="{% url 'logout' %}">
                                {% csrf_token %}
                                <button class="dropdown-item" type="submit"><i class="fa fa-power-off"></i> Logout</button>
                            </form>
                        </ul>
                    </li>


                </ul>
            </div>
        </nav>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="scrollbar-inner sidebar-wrapper">
            <div class="user">
                <div class="photo">
                    <img src="{% static 'img/reals.jpg' %}">
                </div>
                <div class="info">
                    <a data-toggle="collapse" href="#collapseExample" aria-expanded="true">
                        <span>
                            {{ request.user.username }}
                            <span class="user-level">{% if request.user.is_superuser %}Administrator{% else %}Staff{% endif %}</span>
                            <span class="caret"></span>
                        </span>
                    </a>
                    <div class="collapse in" id="collapseExample" aria-expanded="true">
                        <ul class="nav">
                            <li><a href="{% url 'profile' %}"><span class="link-collapse">My Profile</span></a></li>
                            <li><a href="{% url 'edit_profile' %}"><span class="link-collapse">Edit Profile</span></a></li>

                        </ul>
                    </div>
                </div>
            </div>

            <ul class="nav">
                <li class="nav-item"><a href="{% url 'home' %}"><i class="la la-dashboard"></i><p>Dashboard</p></a></li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#productsMenu" aria-expanded="false">
                        <i class="la la-archive"></i><p>Products</p><span class="caret"></span>
                    </a>
                    <div class="collapse" id="productsMenu">
                        <ul class="nav nav-collapse">
                            <li><a href="{% url 'products' %}"><span class="sub-item">Product List</span></a></li>
                            <li><a href="{% url 'product-batch' %}"><span class="sub-item">Product Batch</span></a></li>
                            <li><a href="{% url 'product-inventory' %}"><span class="sub-item">Product Inventory</span></a></li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#rawmatMenu" aria-expanded="false">
                        <i class="la la-cubes"></i><p>Raw Materials</p><span class="caret"></span>
                    </a>
                    <div class="collapse" id="rawmatMenu">
                        <ul class="nav nav-collapse">
                            <li><a href="{% url 'rawmaterials' %}"><span class="sub-item">Raw Materials List</span></a></li>
                            <li><a href="{% url 'rawmaterial-batch' %}"><span class="sub-item">Raw Material Batch</span></a></li>
                            <li><a href="{% url 'rawmaterial-inventory' %}"><span class="sub-item">Raw Material Inventory</span></a></li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item">
                    <a data-toggle="collapse" href="#financialMenu" aria-expanded="false">
                        <i class="la la-dollar"></i><p>Financial Report</p><span class="caret"></span>
                    </a>
                    <div class="collapse" id="financialMenu">
                        <ul class="nav nav-collapse">
                            <li><a href="#index"><span class="sub-item">Report</span></a></li>
                            <li><a href="{% url 'sales' %}"><span class="sub-item">Sales</span></a></li>
                            <li><a href="{% url 'expenses' %}"><span class="sub-item">Expenses</span></a></li>
                        </ul>
                    </div>
                </li>
                                <li class="nav-item">
                    <a data-toggle="collapse" href="#withdrawalsMenu" aria-expanded="false">
                        <i class="la la-trash"></i><p>Withdrawals</p><span class="caret"></span>
                    </a>
                    <div class="collapse" id="withdrawalsMenu">
                        <ul class="nav nav-collapse">
                            <li><a href="{% url 'withdrawals' %}"><span class="sub-item">Withdrawn Items</span></a></li>
                            <li><a href="{% url 'stock-changes' %}"><span class="sub-item">Stock Changes</span></a></li>
                        </ul>
                    </div>
                </li>
                <li class="nav-item"><a href="{% url 'historylog' %}"><i class="la la-history"></i><p>History Log</p></a></li>
            </ul>
        </div>
    </div>

    <!-- Main Panel -->
    <div class="main-panel">
        {% block content %}{% endblock %}
    </div>
</div>

<!-- Toast container -->
<div id="toast-container" aria-live="polite" aria-atomic="true" 
    style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"> 
</div>


<!-- Scripts -->
<script src="{% static 'js/core/jquery.3.2.1.min.js' %}"></script>
<script src="{% static 'js/plugin/jquery-ui-1.12.1.custom/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/core/popper.min.js' %}"></script>
<script src="{% static 'js/core/bootstrap.min.js' %}"></script>
<script src="{% static 'js/plugin/chartist/chartist.min.js' %}"></script>
<script src="{% static 'js/plugin/chartist/plugin/chartist-plugin-tooltip.min.js'%}"></script>
<script src="{% static 'js/plugin/bootstrap-notify/bootstrap-notify.min.js' %}"></script>
<script src="{% static 'js/plugin/bootstrap-toggle/bootstrap-toggle.min.js' %}"></script>
<script src="{% static 'js/plugin/jquery-mapael/jquery.mapael.min.js' %}"></script>
<script src="{% static 'js/plugin/jquery-mapael/maps/world_countries.min.js' %}"></script>
<script src="{% static 'js/plugin/chart-circle/circles.min.js' %}"></script>
<script src="{% static 'js/plugin/jquery-scrollbar/jquery.scrollbar.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<div id="liveToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
  <div class="d-flex">
    <div class="toast-body">
      Hello, this is a test toast!
    </div>
    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const toastEl = document.getElementById('liveToast');
    const toast = new bootstrap.Toast(toastEl, { delay: 3000 });
    toast.show();
  });
</script>


<script>
(function(){
  var html = document.documentElement;
  var key = 'rfp-theme';
  var toggle = document.getElementById('themeToggle');

  // apply saved theme on load
  var saved = localStorage.getItem(key);
  if(saved === 'dark'){ html.setAttribute('data-theme','dark'); if(toggle) toggle.setAttribute('aria-checked','true'); }

  if(toggle){
    toggle.addEventListener('click', function(e){
      e.preventDefault();
      var dark = html.getAttribute('data-theme') === 'dark';
      if(dark){
        html.removeAttribute('data-theme');
        localStorage.setItem(key,'light');
        toggle.setAttribute('aria-checked','false');
      }else{
        html.setAttribute('data-theme','dark');
        localStorage.setItem(key,'dark');
        toggle.setAttribute('aria-checked','true');
      }

      // keep Apex tooltip theme in sync (if using ApexCharts)
      if(window.Apex){
        window.Apex.tooltip = { theme: (html.getAttribute('data-theme') === 'dark') ? 'dark' : 'light' };
      }
    });
  }
})();
</script>


{% block vendor_js %}{% endblock vendor_js %}
{% block page_js %}{% endblock page_js %}           
{% if messages %}
<script>
  document.addEventListener("DOMContentLoaded", function() {
    {% for message in messages %}
      const type = "{{ message.tags }}";
      const text = "{{ message|escapejs }}".replace(
        "Product batch hindi nag add kasi kulang yung raw materials.",
        "Product batch was not added â€” insufficient raw materials."
      );

      const toastHTML = `
        <div class="toast toast-${type}" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="toast-header">
            <i class="me-2 ${
              type === 'success' ? 'la la-check-circle text-success' :
              type === 'error'   ? 'la la-times-circle text-danger' :
              type === 'warning' ? 'la la-exclamation-circle text-warning' :
                                   'la la-info-circle text-info'
            }"></i>
            <strong class="me-auto">Notification</strong>
            <small>Just now</small>
            <button type="button" class="btn-close ms-2 mb-1" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">${text}</div>
        </div>`;

      const container = document.getElementById("toast-container");
      container.insertAdjacentHTML("beforeend", toastHTML);

      // Use Bootstrap 5 API
      const toastEl = container.querySelector(".toast:last-child");
      const bsToast = new bootstrap.Toast(toastEl, { autohide: true, delay: 5000 });
      bsToast.show();
    {% endfor %}
  });
</script>
{% endif %}
</body>
</html>
